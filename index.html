<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mor Training</title>
<meta name="theme-color" content="#0b0f14" />

<style>
  :root{
    --bg:#0b0f14; --bg-2:#0e141b; --card:rgba(255,255,255,.06);
    --card-border:rgba(255,255,255,.12); --text:#e8eef6; --muted:#a7b4c6;
    --accent:#6ee7ff; --accent-2:#89ffbf; --danger:#ff6b6b; --ok:#5cff85;
    --ring:rgba(109,236,255,.6); --shadow:0 20px 40px rgba(0,0,0,.35);
    --radius:18px;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#eef3f8; --bg-2:#e5edf6; --card:rgba(255,255,255,.75);
      --card-border:rgba(10,20,30,.08); --text:#0b1220; --muted:#475466;
      --ring:rgba(0,133,255,.35); --shadow:0 20px 40px rgba(9,30,66,.15);
    }
  }
  body{
    margin:0; color:var(--text);
    font-family: ui-rounded, SF Pro Rounded, SF Pro Display, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    background:
      radial-gradient(1200px 1200px at 10% -10%, #213750 0%, transparent 60%),
      radial-gradient(1200px 1200px at 110% 40%, #1a4f4a 0%, transparent 55%),
      linear-gradient(160deg, var(--bg) 0%, var(--bg-2) 100%);
    min-height:100svh;
  }
  .wrap{ max-width:980px; margin:32px auto 64px; padding:0 20px; }
  .brand{ display:flex; align-items:center; gap:14px; margin-bottom:22px; }
  .badge{ width:42px; height:42px; border-radius:14px;
    background:linear-gradient(145deg, var(--accent), var(--accent-2));
    box-shadow: inset 0 1px 0 rgba(255,255,255,.4), 0 12px 26px rgba(69,198,255,.35);
  }
  h1{ margin:0; font-size:clamp(26px,4vw,34px); letter-spacing:.3px; }
  .subtitle{ color:var(--muted); margin-top:6px; font-size:14px }

  .card{
    background:var(--card); border:1px solid var(--card-border);
    backdrop-filter: blur(16px) saturate(120%);
    border-radius:var(--radius); box-shadow:var(--shadow); overflow:clip;
  }
  .card section{ padding:18px 18px 0 }
  .card section:last-child{ padding-bottom:18px }
  .row{ display:flex; flex-wrap:wrap; gap:12px; align-items:center }
  .spacer{ height:8px }

  .select{
    appearance:none; background:rgba(255,255,255,.06); color:var(--text);
    border:1px solid var(--card-border); border-radius:12px;
    padding:12px 42px 12px 14px; font-size:16px; outline:none;
    transition: box-shadow .2s, border-color .2s, transform .08s;
  }
  .select:focus{ box-shadow:0 0 0 8px var(--ring); border-color:transparent }
  .select-wrap{ position:relative }
  .select-wrap:after{
    content:"▾"; position:absolute; right:12px; top:50%; translate:0 -55%;
    color:var(--muted); pointer-events:none;
  }

  .grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(260px,1fr)); gap:12px; margin-top:10px; }
  .tool{ background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
         border:1px solid var(--card-border); border-radius:16px; padding:14px 14px 12px; }
  .tool h3{ margin:0 0 10px; font-size:16px; font-weight:700; letter-spacing:.2px; }

  /* iOS-like toggles (fixed hit-area) */
  .toggle{ display:inline-flex; align-items:center; gap:10px; user-select:none; }
  .label{ font-size:13px; color:var(--muted); min-width:100px; }
  .switch{
    --w:46px; --h:26px;
    position:relative; display:inline-block; width:var(--w); height:var(--h);
    border-radius:var(--h); background:rgba(255,255,255,.18);
    border:1px solid var(--card-border); cursor:pointer;
    transition: background .25s, border-color .25s, box-shadow .25s;
    box-shadow: inset 0 2px 6px rgba(0,0,0,.25);
  }
  .chk{ position:absolute; inset:0; opacity:0; margin:0; cursor:pointer; }
  .knob{
    position:absolute; top:2px; left:2px;
    width:calc(var(--h) - 4px); height:calc(var(--h) - 4px);
    border-radius:999px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.35);
    transition:left .25s, background .25s, box-shadow .25s;
  }
  .chk:checked + .knob{ left:calc(100% - (var(--h) - 2px)); background:#f7feff }
  .switch:has(.chk:checked){
    background:linear-gradient(90deg, var(--accent), var(--accent-2));
    border-color:transparent; box-shadow:0 6px 18px rgba(110,231,255,.35) inset;
  }

  .actions{ display:flex; align-items:center; justify-content: space-between; gap:12px; margin-top:8px; }
  .btn{
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    padding:12px 16px; border-radius:14px; border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, #101820, #0f151c); color:#ecf6ff; font-weight:600;
    box-shadow:0 10px 22px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.15);
    cursor:pointer; transition: transform .06s, box-shadow .2s, background .3s;
  }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 14px 26px rgba(0,0,0,.38) }
  .btn:active{ transform:translateY(0) scale(.98) }
  .btn[disabled]{ opacity:.6; cursor:not-allowed; filter:saturate(.7) }
  .status{ font-size:13px; color:var(--muted) }
  .status.ok{ color:var(--ok) } .status.err{ color:var(--danger) }
  .foot{ margin-top:14px; text-align:right; color:var(--muted); font-size:12px; }
</style>
</head>
<body>
  <div class="wrap">
    <header class="brand">
      <div class="badge" aria-hidden="true"></div>
      <div>
        <h1>Mor Training</h1>
        <div class="subtitle">Ultra-clean, one-row-per-student with instant updates.</div>
      </div>
    </header>

    <main class="card">
      <section>
        <div class="row">
          <div class="select-wrap">
            <label class="sr-only" for="student">Student</label>
            <select id="student" class="select" required></select>
          </div>
          <div id="status" class="status" role="status" aria-live="polite"></div>
        </div>
      </section>

      <section>
        <div id="tools" class="grid"></div>
      </section>

      <section>
        <div class="actions">
          <button id="submitBtn" class="btn" type="submit" form="form">Save Progress</button>
          <div class="foot">Each save overwrites that student’s row.</div>
        </div>
        <div class="spacer"></div>
      </section>
    </main>

    <!-- hidden form so Enter submits; button references it via form="form" -->
    <form id="form" style="display:none"></form>
  </div>

<script>
  // ---- Data ----
  const TOOLS = [
    "Band Saw","Drill Press","Belt Sander","Disc Sander","Horizontal Bandsaw",
    "Table Saw","Miter Saw","Hand Drill","Soldering Station","3D Printer"
  ];
  const STUDENTS = Array.from({length:30}, (_,i)=>`student${i+1}`);

  // ---- Populate student list ----
  const studentSel = document.getElementById('student');
  studentSel.innerHTML = '<option value="">Choose student…</option>' +
    STUDENTS.map(s=>`<option value="${s}">${s}</option>`).join('');

  // ---- Render tools ----
  const toolsDiv = document.getElementById('tools');
  TOOLS.forEach((tool,i)=>{
    const idQ = `quiz${i}`, idP = `phys${i}`;
    const el = document.createElement('div');
    el.className = 'tool';
    el.innerHTML = `
      <h3>${tool}</h3>
      <div class="row">
        <label class="toggle">
          <span class="label">Quiz done</span>
          <span class="switch">
            <input id="${idQ}" class="chk" type="checkbox" />
            <span class="knob"></span>
          </span>
        </label>
        <label class="toggle">
          <span class="label">Physical done</span>
          <span class="switch">
            <input id="${idP}" class="chk" type="checkbox" />
            <span class="knob"></span>
          </span>
        </label>
      </div>
    `;
    toolsDiv.appendChild(el);
  });

  // ---- Submit logic ----
  const statusEl = document.getElementById('status');
  const btn = document.getElementById('submitBtn');

  document.getElementById('form').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const student = studentSel.value;
    if(!student){ status('Pick a student first.', 'err'); return; }

    const payload = {
      student,
      timestamp: new Date().toISOString(),
      tools: TOOLS.map((t,i)=>({
        tool: t,
        quizDone: document.getElementById(`quiz${i}`).checked,
        physicalDone: document.getElementById(`phys${i}`).checked
      }))
    };

    try{
      btn.disabled = true;
      status('Saving…');
      const res = await fetch('/.netlify/functions/submit', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });
      if(res.ok){
        status(`Saved for ${student}.`, 'ok');
      }else{
        const txt = await res.text().catch(()=> 'Server error');
        status(`Error: ${txt}`, 'err');
      }
    }catch{
      status('Network error.', 'err');
    }finally{
      btn.disabled = false;
    }
  });

  function status(msg, kind){
    statusEl.textContent = msg || '';
    statusEl.classList.toggle('ok', kind==='ok');
    statusEl.classList.toggle('err', kind==='err');
  }

  // (Optional) Disable SW while iterating fast. Re-enable later if you want offline.
  // if ('serviceWorker' in navigator) {
  //   window.addEventListener('load', () => {
  //     navigator.serviceWorker.register('/public/service-worker.js').catch(()=>{});
  //   });
  // }
</script>
</body>
</html>
